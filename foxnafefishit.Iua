-- ðŸŸ Fish It â€¢ RNG Analyzer (Pulau & Secret Probability)
-- by GPT-5 + Allexzzq

if not game:IsLoaded() then
	game.Loaded:Wait()
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

--------------------------------------------------
-- CONFIG
--------------------------------------------------
local MAX_LOG = 20        -- jumlah cast yang dianalisis
local FLAT_THRESHOLD = 0.7 -- tingkat hasil berulang (0-1)
--------------------------------------------------

local CastLog = {}
local ResultCount = {}

-- util
local function resetData()
	CastLog = {}
	ResultCount = {}
end

local function logResult(resultName)
	table.insert(CastLog, resultName)
	ResultCount[resultName] = (ResultCount[resultName] or 0) + 1

	if #CastLog > MAX_LOG then
		local removed = table.remove(CastLog, 1)
		ResultCount[removed] -= 1
		if ResultCount[removed] <= 0 then
			ResultCount[removed] = nil
		end
	end
end

-- analisis pola RNG
local function analyzeRNG()
	local total = 0
	local maxRepeat = 0

	for _, count in pairs(ResultCount) do
		total += count
		if count > maxRepeat then
			maxRepeat = count
		end
	end

	if total == 0 then
		return "UNKNOWN", "Belum cukup data"
	end

	local repeatRatio = maxRepeat / total

	if repeatRatio >= FLAT_THRESHOLD then
		return "LOW", "Hasil stagnan â†’ pindah pulau"
	elseif repeatRatio >= 0.45 then
		return "MEDIUM", "RNG normal â†’ bisa lanjut"
	else
		return "HIGH", "RNG hidup â†’ peluang secret meningkat"
	end
end

-- estimasi peluang (RELATIF, bukan % palsu)
local function estimateSecretChance(status)
	if status == "HIGH" then
		return "TINGGI (relatif)"
	elseif status == "MEDIUM" then
		return "SEDANG (relatif)"
	elseif status == "LOW" then
		return "RENDAH (relatif)"
	else
		return "TIDAK DIKETAHUI"
	end
end

-- OUTPUT GUI sederhana (notifikasi)
local function notify(title, text)
	pcall(function()
		game.StarterGui:SetCore("SendNotification", {
			Title = title,
			Text = text,
			Duration = 5
		})
	end)
end

--------------------------------------------------
-- HOOK DETEKSI HASIL CAST
--------------------------------------------------
-- CATATAN:
-- Bagian ini generic, karena tiap update Fish It bisa beda.
-- Script membaca perubahan tool / result text / value.
--------------------------------------------------

local function onCharacter(char)
	for _, v in pairs(char:GetDescendants()) do
		if v:IsA("StringValue") and v.Name:lower():find("fish") then
			v.Changed:Connect(function()
				logResult(v.Value)
				local status, advice = analyzeRNG()
				local chance = estimateSecretChance(status)

				notify(
					"Fish It â€¢ RNG Analyzer",
					"Status Pulau: "..status..
					"\nPeluang Secret: "..chance..
					"\nSaran: "..advice
				)
			end)
		end
	end
end

if LocalPlayer.Character then
	onCharacter(LocalPlayer.Character)
end
LocalPlayer.CharacterAdded:Connect(onCharacter)

--------------------------------------------------
-- RESET SAAT PINDAH PULAU / SERVER
--------------------------------------------------
notify("Fish It â€¢ RNG Analyzer", "RNG Analyzer aktif\nCast akan dianalisis otomatis")
